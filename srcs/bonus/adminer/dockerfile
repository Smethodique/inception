FROM alpine:3.22.1

# Install PHP and required extensions for Adminer
RUN apk add --no-cache \
    php83 \
    php83-fpm \
    php83-session \
    php83-mysqli \
    php83-pdo \
    php83-pdo_mysql \
    php83-json \
    php83-mbstring \
    php83-curl \
    php83-openssl \
    nginx \
    wget

# Create web directory
RUN mkdir -p /var/www/html

# Download Adminer
RUN wget -O /var/www/html/adminer.php https://github.com/vrana/adminer/releases/download/v4.8.1/adminer-4.8.1.php

# Set permissions
RUN chown -R nginx:nginx /var/www/html

# Copy Nginx configuration for Adminer
COPY config/nginx.conf /etc/nginx/nginx.conf

# Create PHP-FPM configuration
RUN mkdir -p /run/nginx /var/log/nginx

EXPOSE 8080

# Start script
COPY config/start.sh /start.sh
RUN chmod +x /start.sh

CMD ["/start.sh"]

